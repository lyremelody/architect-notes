[返回上层](./README.md)

# 访问控制 Access Control

<strong><font color="red">最后修改于2023-06-08</font></strong>

**本文涉及的概念：**
* Access Control
  * Identity
  * Authentication
  * Authorization
    * OAuth 2.0
    * SSO，Single Sign-On、Single Sign-Off
  * Access Control Models
    * DAC
    * MAC
    * RBAC
  * Access Control Methods and Techniques
    * Rule-Based Access Control
    * Access Control Matrix
      * Capability
      * ACL
  * Access Control Management
  * Account
  * Audit
* 4A(Authentication、Authorization、Account、Audit)
* IAM(Identity and Access Management)

**TODO：画一张图体现各种概念的关系**

关于 4A 与 IAM的区别，有人做了二者差异的对比(下图)：
* 国内企业信息化管理早期多数采用用户名+密码方式进行认证，很多认证厂商以此为突破点，推出产品来加强认证手段。一个证书代表着一个身份，但认证会涉及多个应用，因此他们不得不在认证的基础上，去实现相应的身份管理、认证管理、授权管理和审计管理，即4A的概念。立意的差别，造成了4A产品无论是身份、还是授权、审计等都是为认证服务，因此会导致功能偏向性明显。例如只能提供证书相关的身份管理，不能将身份数据同步给其他应用系统；或只能让所有应用到该证书服务来认证，不能支持跨平台跨域认证，同时不能和其他的认证IDP服务做互信。因此**4A、身份认证、SSO都是强认证、弱管理**。
* 而IAM的**第一个关键词是“身份管理”**，是侧重在以Identity身份为基础，在身份治理的基础上来解决组织管理问题、业务流程问题，从内部到外部、从PC端到移动端、从线下到线上、从人到物等多维度、全方位地构建身份安全管理体系。IAM的**第二个关键词是“连接”**，可把IAM理解为双面插排，作为组织的基础安全设施；向上对接各种认证手段，向下连接各种应用。各种认证方式可理解为该插排上的插头，可换可替；应用系统和IAM之间通过“连接器”可直接插拔。

<div align=center><img src="./access-control/001.png"></div>

- [访问控制 Access Control](#访问控制-access-control)
  - [1 相关场景](#1-相关场景)
    - [1.1 作为员工/用户](#11-作为员工用户)
    - [1.2 作为企业管理员](#12-作为企业管理员)
    - [1.3 作为开发者](#13-作为开发者)
  - [2 Access Control 访问控制](#2-access-control-访问控制)
    - [2.1 主体访问客体的过程](#21-主体访问客体的过程)
    - [2.2 Authentication 身份验证/认证](#22-authentication-身份验证认证)
      - [2.2.1 用于身份验证/认证的3种因素](#221-用于身份验证认证的3种因素)
      - [2.2.2 认证协议](#222-认证协议)
        - [2.2.2.1 Kerberos](#2221-kerberos)
        - [2.2.2.2 LDAP](#2222-ldap)
          - [2.2.2.2.1 目录服务](#22221-目录服务)
          - [2.2.2.2.2 LDAP 简介](#22222-ldap-简介)
          - [2.2.2.2.3 LDAP 基本模型](#22223-ldap-基本模型)
          - [2.2.2.2.4 LDAP 和 AD 的关系](#22224-ldap-和-ad-的关系)
        - [2.2.2.3 SAML](#2223-saml)
        - [2.2.2.4 RADIUS](#2224-radius)
        - [2.2.2.5 OIDC](#2225-oidc)
        - [2.2.2.6 CAS](#2226-cas)
      - [2.2.3 认证源](#223-认证源)
    - [2.3 Authorization 授权](#23-authorization-授权)
      - [2.3.1 OAuth 2.0](#231-oauth-20)
        - [2.3.1.1 安全问题：凭据共享与凭据盗用](#2311-安全问题凭据共享与凭据盗用)
        - [2.3.1.2 OAuth 2.0 解决问题的关键思想：角色分离、授权访问、访问控制](#2312-oauth-20-解决问题的关键思想角色分离授权访问访问控制)
        - [2.3.1.3 OAuth 2.0 的优点](#2313-oauth-20-的优点)
        - [2.3.1.4 OAuth 2.0 的缺点](#2314-oauth-20-的缺点)
        - [2.3.1.5 OAuth 2.0 不能做什么？](#2315-oauth-20-不能做什么)
      - [2.3.2 SSO](#232-sso)
        - [2.3.2.1 SSO，Single Sign-On](#2321-ssosingle-sign-on)
        - [2.3.2.2 SSO，Single Sign-Off](#2322-ssosingle-sign-off)
        - [2.3.2.3 SSO 关注点](#2323-sso-关注点)
        - [2.3.2.4 SSO 实现前提](#2324-sso-实现前提)
        - [2.3.2.5 SSO 优点](#2325-sso-优点)
        - [2.3.2.6 SSO 缺点](#2326-sso-缺点)
    - [2.4 Access Control Models 访问控制模型](#24-access-control-models-访问控制模型)
      - [2.4.1 DAC，自主访问控制](#241-dac自主访问控制)
      - [2.4.2 MAC，强制访问控制](#242-mac强制访问控制)
      - [2.4.3 RBAC，角色型访问控制](#243-rbac角色型访问控制)
        - [2.4.3.1 行业特例-涉密系统三员分立](#2431-行业特例-涉密系统三员分立)
    - [2.5 Access Control Methods and Techniques 访问控制方法和技术](#25-access-control-methods-and-techniques-访问控制方法和技术)
      - [2.5.1 Rule-Based Access Control 规则型访问控制](#251-rule-based-access-control-规则型访问控制)
      - [2.5.2 限制性用户接口](#252-限制性用户接口)
      - [2.5.3 Access Control Matrix 访问控制矩阵](#253-access-control-matrix-访问控制矩阵)
        - [2.5.3.1 Capability 功能表](#2531-capability-功能表)
        - [2.5.3.2 ACL，Access Control List](#2532-aclaccess-control-list)
      - [2.5.4 内容相关访问控制](#254-内容相关访问控制)
      - [2.5.5 上下文相关访问控制](#255-上下文相关访问控制)
    - [2.6 访问控制管理](#26-访问控制管理)
    - [2.7 可问责性](#27-可问责性)
      - [2.7.1 Audit](#271-audit)
  - [3 Account](#3-account)
  - [4 4A](#4-4a)
    - [4.1 系统背景](#41-系统背景)
    - [4.2 4A 是什么](#42-4a-是什么)
    - [4.3 4A 关注点](#43-4a-关注点)
  - [5 IAM](#5-iam)
    - [5.1 IAM，Identity and Access Management](#51-iamidentity-and-access-management)
      - [5.1.1 EIAM](#511-eiam)
      - [5.1.2 CIAM](#512-ciam)
      - [5.1.3 RAM](#513-ram)
    - [5.2 IAM 关注点](#52-iam-关注点)
    - [5.3 企业为什么需要IAM](#53-企业为什么需要iam)
  - [参考资料](#参考资料)


## 1 相关场景
在看 Access Control、SSO、4A、IAM 之前，我们来看下相关场景。

### 1.1 作为员工/用户
* 多套账号密码：在CRM中是老杨/密码1234，在OA中是小杨/密码9527，由于账号过多，经常忘记账号、密码，或者干脆设置同样的或简单的密码。
* 反复注册登录：在不同系统/APP中需要反复地输入账号密码登录，或者反复注册、申请审批。

### 1.2 作为企业管理员
* 管理员工的账号/权限费时费力：无法统一管理员工在公司内不同系统的账号/权限，导致员工缺少账号或拥有过多账号/权限；员工入职、转岗、离职时需要手动开通/收回员工的账号。
* 无法追踪员工的行为：员工的活动分散在企业内各个系统中，无法及时发现、统计员工的行为轨迹，制止风险行为。

### 1.3 作为开发者
* 反复造轮子：针对账号体系、注册登录、第三方登录、用户自主服务等常规和基础的功能需要反复开发。
* 用户数据难打通：即使在公司内部，也容易出现不同系统之间账号体系的设计、口径不一致的情况，导致系统之间的用户数据难以打通。

## 2 Access Control 访问控制
信息安全的根本所在就是通过控制如何访问信息资源来防范资源泄漏或未经授权的修改。访问控制的实现手段在本质上都处于技术性、物理性或行政管理性层面。基于政策的文档、软件和技术、网络设计和物理安全组件都需要实施这种控制方法。

**访问控制是一种安全手段，它控制用户和系统如何与其他系统和资源进行通信和交互。访问控制能够保护系统和资源免受未经授权的访问，并且在身份验证过程成功结束之后确定授权访问的等级。**

在访问控制的环境中，正确理解主体和客体的概念非常重要：
* **访问**是在主体和客体之间进行的信息流动。
* **主体**是一个主动的实体，它请求对客体或客体内的数据进行访问。
* **客体**是包含被访问信息或者所需功能的被动实体。

TODO: 画一个主体、客体的图

### 2.1 主体访问客体的过程
一位用户为了能够访问资源，首先必须证明他是自己所声明的人，拥有必需的凭证，并且具有执行所请求动作的必要权限或特权。一旦这些步骤成功完成，这位用户就能够访问和使用网络资源；然而，我们还需要跟踪该用户的活动以及对其动作实施可问责性。

**身份标识(Identity)** 描述了一种能够确保主体(用户、程序或进程)就是其所声称实体的方法。通过使用用户名或账号就能够提供身份标识。

为了能够进行正确的**身份验证**，主体往往需要提供进一步的凭证，这些凭证可以是密码、密码短语、密钥、个人身份号码(Personal Identification Number, PIN)、生物特征或令牌。这两种凭证项将会与先前为该主体存储的信息进行比较。如果这些凭证与存储的信息相匹配，那么主体就通过了身份验证。但验证工作并未结束。

一旦主体提供了其凭证并且被正确标识了身份，主体试图访问的系统就需要确定该主体是否具有执行请求的动作所需的权限和特权。系统会查看某种访问控制矩阵或比较安全标签，以便验证该主体是否确实能够访问请求的资源和执行试图完成的动作。如果系统确定主体可以访问特定的资源，那么就会为该主体授权。

尽管身份标识、身份验证、授权与可问责性都具有完整和互补的定义，然而它们在访问控制过程中都有着自己明确的作用。
* 一个用户可能能够顺利地通过网络上的身份标识和身份验证，但是可能不被授权访问文件服务器上的文件。
* 另一方面，用户能够被授权访问文件服务器上的文件，但是在未顺利通过身份标识和身份验证之前，他们将无法获取这些资源。

主体在一个系统或区域内的动作应当可问责。**确保可问责性的唯一方法是主体能够被唯一标识，并且主体的动作被记录在案。**

TODO：画一个主体访问客体的4个步骤

### 2.2 Authentication 身份验证/认证
**一个人的身份必需在身份验证/认证过程中被验证。身份验证/认证通常涉及一个包含两个步骤的过程**：
1. 输入公共信息(用户名、雇员号、账号或部门ID)
2. 输入私有信息(静态密码、一次性密码、PIN或数字签名)

输入公共信息是身份标识步骤，而输入私有信息则是两步骤过程中的身份验证步骤。

**身份标识和身份验证/认证所使用的每一项技术都有其优缺点，因此需要在特殊的环境中正确地对其进行评估，以便采用正确的策略。**

身份验证就是要证明“主体是谁”。

#### 2.2.1 用于身份验证/认证的3种因素
1. **某人知道的内容(根据知识进行身份验证/认证)**，可以是密码、PIN、母亲的娘家姓氏或密码锁。通过某人知道的内容进行身份验证实现起来往往是最经济的。这种方法的不利方面就是其他人也可能获得相关知识并能够对系统或设施进行未授权访问。
2. **某人所拥有的物品(根据所有权进行身份验证/认证)**，可以是钥匙、门卡、访问卡或证件。这种方法常用于访问设施，不过也可用于访问敏感区域或身份验证系统。该方法的确定是这些物品容易丢失或被盗，从而导致未授权访问。
3. **某人的身份(根据特征进行身份验证/认证)**，这种方法并不基于某人是火星人或者低能儿，而是基于物理特征。基于独特的物理特征对一个人的身份进行验证称为生物测定学。

**强身份验证**包含上面3种身份验证方法中的两种。也成为**双因素身份验证**。强身份验证有时也叫做多重身份验证，即使用两个或两个以上的方法进行验证。也可以使用**三因素身份验证**，即同时使用所有的验证方法。

#### 2.2.2 认证协议
认证协议是一种计算机通信协议或密码协议，专门设计用于在两个实体之间传输身份验证数据。它允许接收实体通过声明认证所需的信息类型和语法来认证连接实体(例如，连接到服务器的客户端)以及向连接实体(服务器到客户端)认证自己。它是计算机网络中安全通信所需的最重要的保护层。

**认证协议主要用于在用户、业务系统、身份认证服务之间传递用户信息，告诉业务系统“此用户是谁”**。

主流的认证协议有：
* Kerberos
* LDAP，Lightweight Directory Access Protocol
* SAML，Security Assertion Markup Language
* RADIUS，Remote Authentication Dial-In User Service
* OIDC，OpenID Connect 
* CAS
* Cookie
* JWT
* ...

##### 2.2.2.1 Kerberos
##### 2.2.2.2 LDAP
###### 2.2.2.2.1 目录服务
日常生活中使用的电话薄内记录着亲朋好友的姓名、电话与地址等数据，它就是 telephone directory(电话目录)；计算机中的文件系统(file system)内记录着文件的文件名、大小与日期等数据，它就是 file directory(文件目录)。如果这些目录内的数据能够由系统加以整理，用户就能够容易且迅速地查找到所需的数据，而 directory service(目录服务)提供的服务，就是要达到此目的。**目录服务是一个特殊的非关系型数据库，用来保存描述性的、基于属性的详细信息，支持过滤功能**。这种数据库与我们常⻅的关系型数据库(Mysql、SQL Server、Oracle等)的区别在于目录服务以树状的层次结构来存储数据，就好像 Linux/Unix 系统中的文件目录一样。此外，目录服务是一个专⻔为搜索和浏览而优化的数据库，有着优异的读性能，但写性能差，并且没有事务处理、回滚等复杂功能，不适于存储修改频繁的数据。综上所述，目录服务更适用于存储如组织架构之类的信息。

###### 2.2.2.2.2 LDAP 简介
**LDAP(Light Directory Access Portocol)是基于 X.500 标准的轻量级目录访问协议**。LDAP 协议之前有一个 X.500 DAP 协议规范，该协议十分复杂，是一个重量级的协议，后来对 X.500 进行了简化，诞生了 LDAP 协议，与 X.500 相比变得较为轻量，其实 LDAP 协议依然复杂。

LDAP 约定了 Client 与 Server 之间的信息交互格式、使用的端口号、认证方式等内容。而 LDAP 协议的实现，有着众多版本，例如：
* **微软的 Active Directory** 是 LDAP 在 Windows 上的实现，AD 实现了 LDAP 所需的树形数据库、具体如何解析请求数据并到数据库查询然后返回结果等功能。
* **Red Hat Directory Servers** 是用于在 UNIX 环境中通过 Red Hat Directory Server 管理多个系统的工具。红帽目录服务器允许用户将用户详细信息存储在 LDAP 服务器中。该工具为用户提供对目录数据，组成员身份和远程访问以及通过验证过程的访问的安全且受限制的访问。
* **IBM Tivoli Directory Server** 是基于 IBM 的 LDAP 实现。基于 LDAP 框架。该工具专注于更快地开发和分发身份控制，安全性和 Web 应用程序。Tivoli Directory Server 包括不同的验证方法，例如通过数字证书，简单认证和安全层（SASL）和 CRAM-MD5 进行的验证。
* **OpenLDAP** 是可以运行在 Linux 上的 LDAP 协议的开源实现。
* 而我们平常说的 LDAP Server，一般指的是安装并配置了 Active Directory、OpenLDAP 这些程序的服务器。

###### 2.2.2.2.3 LDAP 基本模型
每一个系统、协议都会有属于自己的模型，LDAP 也不例外，在了解 LDAP 的基本模型之前我们需要先了解几个 LDAP 的目录树概念:
1. 目录树：在一个目录服务系统中，整个目录信息集可以表示为一个目录信息树，树中的每个节点是 一个条目。
2. 条目：每个条目就是一条记录，每个条目有自己的唯一可区别的名称(DN)。
3. 对象类：objectClass，与某个实体类型对应的一组属性，对象类是可以继承的，这样父类的必须属性也会被继承下来。
4. 属性：描述条目的某个方面的信息，一个属性由一个属性类型和一个或多个属性值组成，属性有必须属性和非必须属性。

LDAP 目录以树状的层次结构来存储数据，最顶层即根部称作「基准DN」，形如 ```dc=lyremelody,dc=cn``` 或者 ```ou=lyremelody.cn```，前一种方式更为灵活也是 Windows AD 中使用的方式。在根目录的下面有很多的文件和目录，为了把这些大量的数据从逻辑上分开，LDAP 像其它的目录服务协议一样使用 ```OU(Organization Unit)```，可以用来表示公司内部机构，如部⻔等，也可以用来表示设备、人员等。同时 OU 还可以有子 OU，用来表示更为细致的分类。LDAP 中每一条记录都有一个唯一的区别于其它记录的名字 ```DN(Distinguished Name)```，其处在「叶子」位置的部分称作 RDN；如 ```dn:cn=tom,ou=animals,dc=lyremelody,dc=cn``` 中 tom 即为 RDN；RDN 在一个 OU 中必须是唯一的。

因为 LDAP 数据是「树」状的，而且这棵树是可以无限延伸的，假设你要树上的一条记录，如何寻找它的位置呢？当然首先要说明是哪一棵树(dc)，然后是从树根到那个苹果所经过的所有「分叉」(ou)，最后就是这个苹果的名字(cn)。知道了树(dc=lyremelody,dc=cn)，分叉 (ou=IT,ou=Worker,ou=Pentester)，苹果(cn=abc)，就可以找到我们想要的苹果了：
```
dn:cn=abc,ou=IT,ou=Worker,ou=Pentester,dc=lyremelody,dc=cn
```

LDAP 的功能模型中定义了一系列利用 LDAP 协议的操作。它包含了三个部分:
* **查询操作(Interrogation Operations)**：容许查询目录和取得数据。它包含 Search Operating 和 Compare Operation。
* **更新操作(Update Operations)**：容许添加(ADD)、删除(Delete)、重命名(Rename)和改变目录(Modify)
* **认证和管理操作(Authentication And Control Operations)**：容许客户端在目录中识别自己，并且能够控制一个 Session 的性质。

###### 2.2.2.2.4 LDAP 和 AD 的关系
Active Directory 是微软基于 LDAP 协议的一套解决方案(LDAP 服务器 + 应用)， 而 LDAP 是与 AD 交互的协议之一。

Active Directory 解决了细粒度的权限控制「谁」以 「什么权限」访问「什么」。AD 在 LDAP v3 规范之上还有自定义扩展，例如，帐户锁定，密码到期等。

##### 2.2.2.3 SAML
##### 2.2.2.4 RADIUS
##### 2.2.2.5 OIDC
##### 2.2.2.6 CAS

#### 2.2.3 认证源
认证源指的是用户在登录当前系统时，由第三方提供认证服务，系统信任第三方的认证结果。例如使用微信登录某APP。就是将微信作为认证源。

### 2.3 Authorization 授权
> 既然现在我知道你是谁了， 我们看看能让你做些什么。

尽管身份验证和授权完全不同，但是它们需要互相配合完成两步骤操作才能确认用户是否被允许访问特定的资源。
1. 第一个步骤是身份验证，用户必须向系统证明他就是自己声称的人，即被许可的系统用户。
2. 身份验证成功之后，系统必须确认用户已被授权访问特定资源以及被许可对该资源执行哪些操作。

#### 2.3.1 OAuth 2.0
OAuth 2.0 是行业标准的**授权协议**。

OAuth 2.0 设计的重要假设：不受控的客户端总比授权服务器或者受保护资源多出好几个数量级

OAuth 2.0 (RFC6749)：让最终用户通过OAuth将他们在受保护资源上的部分权限委托给客户端应用，使客户端应用代表他们执行操作。

全景图如下：
<div align=center><img src="./access-control/OAuth2.0.png"></div>

##### 2.3.1.1 安全问题：凭据共享与凭据盗用
在传统的客户端-服务器身份认证模型中，客户端通过使用资源所有者的凭据与服务器进行身份认证来请求服务器上的访问受限资源(受保护的资源)。
为了向第三方应用程序提供对受限资源的访问权限，资源所有者与第三方共享其凭据。这会产生几个问题和限制：
1. 第三方应用程序需要存储资源所有者的凭据以供将来使用，通常是明文密码。
2. 服务器必须支持密码验证，尽管密码本身存在安全漏洞。
3. 第三方应用程序获得了对资源所有者受保护资源的过于广泛的访问权限，使资源所有者无法限制持续时间或访问有限的资源子集。
4. 资源所有者不能在不撤销所有第三方的访问权限的情况下撤销对单个第三方的访问权限，并且必须通过更改第三方的密码来实现。
5. 任何第三方应用程序的泄露都会导致最终用户的密码以及受该密码保护的所有数据的泄露。

##### 2.3.1.2 OAuth 2.0 解决问题的关键思想：角色分离、授权访问、访问控制
OAuth 通过引入授权层并将客户端的角色与资源所有者的角色分离来解决这些问题。
在 OAuth 中，客户端请求访问由资源所有者控制并由资源服务器托管的资源，并获得与资源所有者不同的一组凭据。
客户端不是使用资源所有者的凭证来访问受保护的资源，而是获得一个访问令牌——一个表示特定范围、生命周期和其他访问属性的字符串。
访问令牌由授权服务器在资源所有者的批准下颁发给第三方客户端。客户端使用访问令牌访问资源服务器托管的受保护资源。
例如，最终用户(资源所有者) 可以授权打印服务(客户端) 访问她存储在照片共享服务(资源服务器) 中的受保护照片，而无需与打印服务共享她的用户名和密码。相反，她直接向照片共享服务(授权服务器) 信任的服务器进行身份认证，该服务器颁发打印服务委托特定的凭据(访问令牌)。

##### 2.3.1.3 OAuth 2.0 的优点
1. 更安全，客户端不接触⽤户密码，服务端更易集中保护
2. ⼴泛传播并被持续采⽤
3. 模块化和可扩展性好，⽀持多种客户端架构场景
4. 短寿命和封装的令牌
5. 资源服务器和授权服务器解耦
6. 集中式授权，简化客户端
7. HTTP/JSON友好，易于请求和传递令牌
8. 客户可以有不同的信任级别

##### 2.3.1.4 OAuth 2.0 的缺点
1. OAuth 2.0只是一个协议，不是具体实现
2. 不同产品/框架有不同的实现，会出现兼容性问题

##### 2.3.1.5 OAuth 2.0 不能做什么？
1. OAuth 是一个授权协议，不是身份认证协议
2. OAuth 没有定义 HTTP 协议之外的情形
3. OAuth 没有定义用户对用户的授权机制
4. OAuth 没有定义授权处理机制
5. OAuth 没有定义令牌格式
6. OAuth 没有定义加密算法
7. OAuth 不是单体协议：该规范被分成了多个定义和流程，每个定义和流程都有各种适用的场景

#### 2.3.2 SSO
##### 2.3.2.1 SSO，Single Sign-On
SSO (Single sign-on)，单点登录(单一签入)，一种对于许多相互关连，但是又是各自独立的软件系统，提供访问控制的属性。当拥有这项属性时，当用户登录时，就可以获取所有系统的访问权限，不用对每个单一系统都逐一登录。SSO 是一种帮助用户快捷访问网络中多个站点的安全通信技术。

单点登录系统基于一种安全的通信协议，该协议通过多个系统之间的用户身份信息的交换来实现单点登录。使用单点登录系统时，用户只需要登录一次，就可以访问多个系统，不需要记忆多个口令密码。单点登录使用户可以快速访问网络，从而提高工作效率，同时也能帮助提高系统的安全性。

##### 2.3.2.2 SSO，Single Sign-Off
同样，单一退出 (Single sign-off)，只需要单一的退出动作，就可以结束对于多个系统的访问权限。

##### 2.3.2.3 SSO 关注点
1. 解决用户体验问题
2. 无特定类别的用户
3. 实现一点登录、全局进入，无访问控制能力。

##### 2.3.2.4 SSO 实现前提
要实现SSO，需要以下主要功能：
1. **系统共享**：统一的认证系统是SSO的前提之一。认证系统的主要功能是将用户的登录信息和用户信息库相比较，对用户进行登录认证；认证成功后，认证系统应该生成统一的认证标识(ticket)，返还给用户；另外，认证系统还应该对ticket进行校验，判断其有效性。
2. **信息识别**：要实现SSO让用户只登录一次，就必须让应用系统能够识别已经登录过的用户。应用系统应该能对ticket进行识别和提取，通过与认证系统的通讯，能自动判断当前用户是否登录过，从而完成单点登录的功能。

另外：
1. **单一的用户信息数据库并不是必须的**，有许多系统不能将所有的用户信息都集中存储，应该允许用户信息放置在不同的存储中。事实上，只要统一认证系统、统一ticket的生成和校验，无论用户信息存储在什么地方，都能实现单点登录。
2. **统一的认证系统并不是说只有单个的认证服务器**。当用户在访问“应用系统1”时，由第一个认证服务器进行认证后，得到由此服务器产生的ticket。当他访问“应用系统2”时，“认证服务器2”能够识别此ticket是由第一个认证服务器产生的，通过认证服务器之间标准的通讯协议(例如SAML)来交换认证信息，仍然能够完成SSO的功能。

##### 2.3.2.5 SSO 优点
SSO为所有其它应用程序和系统，以集中的验证服务器提供身份验证并结合技术，确保用户不必频繁输入密码。

使用单点登录的好处包括：
* 降低访问第三方网站的风险（不存储用户密码，或在外部管理）。
* 减少因不同的用户名和密码组合而带来的密码疲劳。
* 减少为相同的身份重新输入密码所花费的时间。
* 因减少与密码相关的调用IT服务台的次数而降低IT成本。

##### 2.3.2.6 SSO 缺点
* 不利于重构：因为涉及的系统很多，要重构必须要兼容所有的系统，可能很耗时。
* 无人看守桌面时有安全风险：因为只需要登录一次，所有的授权的应用系统都可以访问，可能导致一些很重要的信息泄露。

### 2.4 Access Control Models 访问控制模型
访问控制模型是规定主体如何访问客体的一种架构，它使用访问控制技术和安全机制来实现模型的规则和目标。

#### 2.4.1 DAC，自主访问控制
* **定义**：DAC(Discretionary Access Control)，自主访问控制。使用自主访问控制的系统使资源所有者能够指定哪些主体可以访问资源。因为**对访问的控制基于所有者的自主决定**，所以这种模型成为自主型。在DAC模型中，基于为用户授予的权限限制访问。这意味着，**用户被允许指定对其拥有的客体的访问类型**。
* **实现方式**：**DAC的最常见实现方式是访问控制列表(ACL)**，ACL由所有者规定和设置，由系统实施。我们使用的大多数操作系统都基于DAC模型，如所有的Windows、Linux以及主流的Unix系统。查看文件或目录的属性，了解哪些用户可以访问这些资源，允许什么类型的访问，这些都是使用ACL实现DAC模型的实例。
* **优点**：对于用户来讲，DAC系统提供了大量的灵活性，需要进行信息技术管理工作较少，能够让用户对数据/资源自主控制权限。
* **缺点**：容易被病毒攻击。恶意软件可以自己安装且在用户的安全环境下运行。比如，如果用户打开了一个感染了病毒的附件，那么该代码便可以在用户毫不知情的情况下在后台进行自我安装。一般情况下，这个代码拥有用户拥有的所有权限和许可，且可以执行用户在这个系统上执行的任何活动，可以胡作非为了。

#### 2.4.2 MAC，强制访问控制
* **定义**：MAC(Mandatory Access Control)，强制访问控制。在强制访问控制(MAC)中，用户不像在DAC模型中那样拥有决定谁能访问客体的权力。出于安全的考虑，基于MAC模型的操作形态大大减少了用户的权利、许可和可用功能。在基于MAC模型的多数系统中，用户不能安装软件、改变软件许可级别和添加新用户等。这个系统仅供用户从事非常特定且具体的活动。这些系统等用途通常非常具体，它们的使用是为了保护高密级数据。多数普通人都没有用到过MAC型系统，因为这些系统多由政府机构使用，用来存储最高机密的信息。
* **实现方式**：MAC模型更为结构化、更为严格，并且**基于安全标签系统**。用户被赋予一个安全许可(秘密、绝密、机密等)，并且数据以相同的方式分类。安全许可和分类数据存储在安全标签内，安全标签则绑定在特定的主体和客体上。当系统收到一个对客体的访问请求时，它会根据主体的安全许可、客体的分类以及系统的安全策略来做出决策。**例如，A资源拥有敏感标签B，C用户拥有敏感标签D，如果D不小于B，则B可以访问A**。**主体如何访问客体的规则由安全政策确定，由管理员配置，由操作系统实施，由安全技术支持。**

* **优点**：MAC系统实施了严格的访问控制，提供了很大的安全性，对于恶意软件尤为奏效。
* **缺点**：不够灵活，如供用户使用的功能非常有限，需要大量的管理费用，本身价格昂贵，不方便用户使用。

**DAC系统适用于通用计算机，而MAC系统只适用于具有某些特定用途的计算机、用于信息分类和机密性要求非常高的环境，如军队、政府机构和与政府接触的公司。**

**DAC系统是自主访问型的，而MAC系统被认为是非自主访问型的，因为用户不能根据他们自己的权力(选择)做出访问决策。**

注：“安全标签”和“敏感度标签”可以交换使用。

#### 2.4.3 RBAC，角色型访问控制
* **定义**：RBAC(Role-Based Access Control)，角色型访问控制。

##### 2.4.3.1 行业特例-涉密系统三员分立
“三员”，在国家保密标准BMB20-2007《涉及国家秘密的信息系统分级保护管理规范》中提出，要求涉密信息系统应当配备系统管理员、安全保密员和安全审计员三类安全保密管理人员（简称为“三员”)，分别负责系统运行、安全保密管理和安全审计工作。

**“三员”并不是特指三个人，而是代表涉密信息系统安全保密管理的三类岗位或角色**，对应不同的职责，由相关人员担任，以相应权限的管理员账号登录设备或系统来完成各项工作。“三员”担负维护系统安全、稳定、可靠运行的重要任务，对涉密信息系统和国家秘密安全具有重要作用。

**“三员”的主要职责和分工**：
* **系统管理员**主要负责系统的日常运行维护，包括：
  * 网络设备、安全保密产品、服务器和用户终端、操作系统、数据库、涉密业务应用系统的安装、配置、升级、维护、运行管理；
  * 网络和系统的用户增加或删除；
  * 网络和系统的数据备份、运行日志审查和运行情况监控；
  * 应急条件下的安全恢复，等等。
* **安全保密管理员**主要负责系统日常安全保密管理,包括：
  * 网络和系统用户权限的授予与撤销；
  * 用户操作行为的安全审计;
  * 安全保密设备管理；
  * 系统安全事件的审计、分析、处理;
  * 应急条件下的安全恢复，等等。
* **安全审计员**主要负责安全审计工作，包括：
  * 对系统管理员、安全保密管理员的操作行为进行审计分析和监督检查，以及时发现违规行为。
* 此外，“三员”还应承担保密和信息化部门赋予的其他相关工作。比如,管理设备台账，组织设备维修,定期对涉密信息系统使用人员进行培训，配合开展涉密信息系统安全保密测评审批、保密检查等工作。

**“三员”的配置**：
* 根据中央有关文件规定，涉密信息系统“三员”应当由本单位内部人员担任。担任涉密信息系统“三员”的人员，政治上应当可靠，应熟悉涉密信息系统管理操作流程,具有较强的责任意识和风险防控意识。
* 在实际工作中，网络设备、安全保密设备、服务器、用户终端、操作系统、数据库等通用设备和系统的管理,技术性要求较高,管理这些设备和系统的系统管理员、安全保密管理员可由信息化部门专业技术人员担任。
* 对于涉密信息系统中运行的一些业务性比较强的涉密应用系统,如人事管理系统、财务管理系统等，对业务要求相对较高，因此,管理这些业务应用系统的系统管理员、安全保密管理员可由相关业务部门的人员担任。
* 此外，各类设备和系统的安全审计员可根据工作需要，由保密部门或其他能够胜任安全审计员工作的人员担任。需要注意的是，同一设备或系统的系统管理员和安全审计员不得由同一人兼任,安全保密管理员和安全审计员也不得由同一人兼任。

### 2.5 Access Control Methods and Techniques 访问控制方法和技术
#### 2.5.1 Rule-Based Access Control 规则型访问控制
#### 2.5.2 限制性用户接口
#### 2.5.3 Access Control Matrix 访问控制矩阵
##### 2.5.3.1 Capability 功能表
##### 2.5.3.2 ACL，Access Control List
#### 2.5.4 内容相关访问控制
#### 2.5.5 上下文相关访问控制
### 2.6 访问控制管理
### 2.7 可问责性
#### 2.7.1 Audit
## 3 Account
## 4 4A
### 4.1 系统背景
随着信息技术的不断发展和信息化建设的不断进步，业务应用、办公系统、商务平台不断推出和投入运行，信息系统在企业的运营中全面渗透。电信行业、财政、税务、公安、金融、电力、石油、大中型企业和门户网站，使用数量众多的网络设备、服务器主机来提供基础网络服务、运行关键业务，提供电子商务、数据库应用、ERP和协同工作群件等服务。由于设备和服务器众多，系统管理员压力太大等因素，越权访问、误操作、滥用、恶意破坏等情况时有发生，这严重影响企业的经济运行效能，并对企业声誉造成重大影响。另外黑客的恶意访问也有可能获取系统权限，闯入部门或企业内部网络，造成不可估量的损失。如何提高系统运维管理水平，跟踪服务器上用户的操作行为，防止黑客的入侵和破坏，提供控制和审计依据，降低运维成本，满足相关标准要求，越来越成为企业关心的问题。

**1995年，国际网安界最早提出4A(认证Authentication、授权Authorization、账户Accounting、审计Audit)统一安全管理平台解决方案概念**，正式将身份认证作为整个网络安全的基础及不可或缺的组成部分，即将身份认证、授权、账户和审计，定义为网络安全的四大组成部分，从而确立了身份认证在整个网络安全系统中的地位与作用。

2002年由美国总统布什签发的萨班斯法案(Sarbanes-Oxley Act)开始生效。其中要求企业的经营活动，企业管理、项目和投资等，都要有控制和审计手段。因此，管理人员需要有有效的技术手段和专业的技术工具和安全产品按照行业的标准来做细粒度的管理，真正做到对于内部网络的严格管理，可以控制、限制和追踪用户的行为，判定用户的行为是否对企业内部网络的安全运行带来威胁。

2007年，由公安部、国家保密局、国家密码管理局、国务院信息工作办公室四部门联合印发了《信息安全等级保护管理办法》，为我国信息系统等级保护工作的迅速展开起到了有力的促进作用。配合该《管理办法》的发布，一系列相关国家标准也进入紧锣密鼓的制定和审批当中。如：《信息系统安全等级保护基本要求》（以下简称《基本要求》）、《信息系统安全等级保护-定级指南》、《信息系统安全等级保护-实施指南》、《信息系统安全等级保护-测评准则》等。其中《基本要求》针对每个等级的信息系统提出相应安全保护要求，按照《基本要求》进行保护后，信息系统达到一种相对安全的状态，即具备了相应等级的信息安全保护能力。

### 4.2 4A 是什么
4A是指：Authentication(认证)、Authorization(授权)、Account(账号)、Audit(审计)，中文名称为统一安全管理平台解决方案。即将身份认证、授权、账号和审计定义为网络安全的四大组成部分，从而确立了身份认证在整个网络安全系统中的地位与作用。

所谓4A统一安全管理平台解决方案，即融合统一用户账号管理、统一认证管理、统一授权管理和统一安全审计四要素后的解决方案将涵盖单点登录（SSO）等安全功能，既能够为客户提供功能完善的、高安全级别的4A管理，也能够为用户提供符合萨班斯法案（SOX）要求的内控报表。

### 4.3 4A 关注点
1. 关注用户、认证、权限和审计
2. 面向内部员工、具备人员生命周期管理
3. 具备用户登录时的访问控制
4. 关注权限统一管理
5. 用户身份变化和访问信息记录后可以事后审计

## 5 IAM
### 5.1 IAM，Identity and Access Management
IAM (Identity and Access Management)，即身份认证和访问管理。Gartner 对 IAM 的定义是：“让正确的人在正确的时间以正确的理由访问正确的资源”。

IAM 定义和管理个人网络用户的角色和访问权限，以及规定用户获得授权(或被拒绝授权)的条件。IAM系统的核心目标是为每个用户赋予一个身份。该数字身份一经建立，在用户的整个“访问生命周期”存续期间都应受到良好的维护、调整与监视。因此，IAM的目标就是：从用户登录系统到权限授予到登出系统的整个过程中，根据需要在恰当的条件下及时赋予正确的用户对企业内适当资产的访问权。

换句话说，IAM 是一种 IT 解决方案，使用身份这种唯一用户配置文件管理用户并将用户安全连接到 IT 资源，包括设备、应用、文件、网络等。每个用户都能配置一个唯一的身份，从而控制对 WiFi 和企业服务器等资源的访问，同时限制其访问工作内容以外的数字资产。

IAM 核心功能包括：
* 认证(Authentication)管理
* 授权(Authorization)管理
* 账号(Account)管理
* 审计(Audit)管理

传统的 IAM 提供商又被称为 4A 厂商，他们为企业集成现有系统，构建用户管理、身份认证、权限管理、审计整合于一体的集成应用平台。

基于场景划分，IAM可以分为三大类：
1. EIAM (Employee Identity and Access Management)
2. CIAM (Customer Identity and Access Management)
3. RAM (Resource and Access Management)

#### 5.1.1 EIAM
EIAM (Employee Identity and Access Management)，指管理企业内部员工的IAM，主要解决员工使用的便捷性和企业管理的安全性相关问题。
 
在产品形态上，EIAM有以下特点：
* 需要集成企业的云应用、本地应用
* 需要集成不同的身份源
* SSO和MFA很常用
* 不同企业所需的访问控制力度不同

#### 5.1.2 CIAM
CIAM (Customer Identity and Access Management)，指管理企业外部客户/用户的IAM，主要解决用户数据打通和开发成本与标准化相关问题。

在产品形态上，CIAM有以下特点：
* 在用户端常见到的是单点登录和授权登录
* 提供通用的组件给开发者直接使用
* 更强调高性能和高可用

#### 5.1.3 RAM
云厂商的IAM，有时称为RAM (Resource and Access Management)，指管理企业云资源的IAM，主要用于管理云资源的访问控制。

在产品形态上，云厂商IAM有以下特点：
* 强调授权的灵活性和企业管理的安全性
* 支持多种类型的账号进行认证或被调用
* 一般只关注管理自家的云资源

### 5.2 IAM 关注点
1. 面向员工、合作伙伴、顾客、设备、应用、特权账号、物理设备等，实现全生命周期管理
2. 实现 Service All In 的大点，将B/S、C/S不同类别的应用、不同浏览器的访问统一纳管
3. 实现应用级别的细粒度权限、AP操作、数据权限统一管理
4. 访问控制从静态转向动态，具备实时风险发现极致和风险闭环管理的能力
5. 实现身份能力的云服务化，增强用户隐私管理

### 5.3 企业为什么需要IAM
IAM 是任何企业安全计划的重要一环，因为在今天的数字化经济中，它与企业的安全和生产力密不可分。IAM 可以通过为用户设备添加指纹并部署多因素身份验证(MFA)来检测和拒绝来自无法识别平台的登录尝试，从而防止凭据填充攻击。IAM解决方案还限制了每个用户登录后能够访问的应用程序和服务范围。因此，即使恶意行为者获得了有效的凭据并可以绕过MFA，IAM解决方案也将严格限制攻击面和减少“横向移动”，做到“可防可控”。

凭证填充攻击的日益增长是许多公司采用IAM进行自我保护的原因之一。被盗用户凭证往往是进入企业网络及其信息资产的入口点。企业运用身份管理来守护信息资产，使其不受日渐增多的勒索软件、犯罪黑客活动、网络钓鱼和其他恶意软件攻击的影响。很多企业里，用户有时候会拥有超出工作所需的访问权限。而健壮的IAM系统可以贯彻用户访问规则和策略，为整个企业加上一层重要的防护。

由于混合办公和远程办公证逐渐成为常态，企业不得不考虑部署 IAM 策略。数据泄露的首要原因就是身份泄露，而要解决身份泄露，IAM 或许是企业首选的安全工具。远程环境迫使企业将 IT 总体战略的重心从网络转向人员。今天的 IT 部门主要负责最大限度保护远程员工的身份安全，同时帮助他们安全访问办公所需资源。而 IAM 则进一步推动了这一战略转变，因为 IAM 的核心内容就是个人安全。全面的云 IAM 平台包括目录服务和单点登录（SSO）功能，基于零信任原则将用户连接到所需的 IT 资源，同时让 IT 部门对身份进行主要控制。现代化的 IAM 平台让用户可以记住并使用唯一身份，也为 IT 管理员提供最高级别的集中控制。

## 参考资料
1. [SSO、4A到IAM 的进化](https://zhuanlan.zhihu.com/p/464185329)
2. [4A](https://baike.baidu.com/item/4A/1825)
3. [单点登录](https://zh.wikipedia.org/zh-cn/%E5%96%AE%E4%B8%80%E7%99%BB%E5%85%A5)
4. [SSO](https://baike.baidu.com/item/SSO/3451380)
5. [Introduction to Single Sign-On](http://www.opengroup.org/security/sso/sso_intro.htm)
6. [IDaaS 已经替代传统 IAM 成为企业标配](https://zhuanlan.zhihu.com/p/298198878)
7. [一文读懂IAM（身份与访问管理）](https://www.woshipm.com/it/4681031.html)
8. [守护沃土数字平台的“闸门”：OneAccess统一身份与访问管理](https://e.huawei.com/cn/blogs/industries/insights/2020/one-access-roma)
9. [【涨知识】认识IAM，向着“零信任”安全架构迈进](https://mp.weixin.qq.com/s/PneehAwkLRt8gtoMmpdmjQ)
10. [什么是身份和访问管理（IAM）？](https://blog.csdn.net/yuzijiang11111/article/details/123273176)
11. [RFC6749: The OAuth 2.0 Authorization Framework](https://datatracker.ietf.org/doc/html/rfc6749)
12. [CISSP 认证考试指南(第6版)](https://book.douban.com/subject/25827062/)
13. [Types of Authentication Protocols](https://www.geeksforgeeks.org/types-of-authentication-protocols/)
14. [LDAP 协议相关, Geekby's Blog](https://www.geekby.site/2020/12/ldap-%E5%8D%8F%E8%AE%AE/)
15. [浅谈涉密系统三员管理](https://zhuanlan.zhihu.com/p/427733689)